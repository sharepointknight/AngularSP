var angularSP=angular.module("AngularSP",[]);angularSP.service("AngularSPREST",["$http","$q",function(n,t){var i=this,r=[];this.GetUpdatedDigest=function(u){var e=t.defer(),o,f,s;return u=i.SanitizeWebUrl(u),o=!1,f=i.Support.GetDigestFromCache(u),o=f===null,f!=null&&f.digestData!=null&&f.digestExpires.getTime()>(new Date).getTime()?e.resolve(f.digestData):s=n({url:u+"_api/contextinfo",method:"POST",headers:{Accept:"application/json; odata=verbose"}}).then(function(n){o&&(f={digestData:null,digestExpires:null,webUrl:u},r.push(f));f.digestData=i.Support.GetJustTheData(n).GetContextWebInformation;var t=f.digestData.FormDigestTimeoutSeconds,s=new Date;f.digestExpires=new Date(s.getTime()+t*1e3);e.resolve(f.digestData)},function(n,t){console.log("Error getting new digest");e.reject(t)}),e.promise};this.GetItemTypeForListName=function(n){return n=n.replace(/_/g,"_x005f_").replace(/-/g,""),"SP.Data."+n.charAt(0).toUpperCase()+n.split(" ").join("").slice(1)+"ListItem"};this.GetUrlPrefix=function(){i.IsSharePointHostedApp};this.Support={GetJustTheData:function(n){var t=n;return typeof t.data!="undefined"&&(t=t.data,typeof t.d!="undefined"&&(t=t.d,typeof t.results!="undefined"&&(t=t.results))),t},EndsWith:function(n,t){return n.indexOf(t,n.length-t.length)!==-1},GetCurrentDigestValue:function(n){n=i.SanitizeWebUrl(n);var t=i.Support.GetDigestFromCache(n);return t!=null&&t.digestData!=null&&t.digestExpires.getTime()>(new Date).getTime()?t.digestData.FormDigestValue:$("#__REQUESTDIGEST").val()},GetDigestFromCache:function(n){for(var t=0;t<r.length;t++)if(r[t].webUrl==n)return r[t];return null}};this.SanitizeWebUrl=function(n){return(typeof n=="undefined"||n==null||n=="")&&(n=_spPageContextInfo.siteAbsoluteUrl),n.endsWith("/")===!1&&(n+="/"),n};this.CreateListItem=function(r,u,f){var o=i.GetItemTypeForListName(r),e;return f.__metadata={type:o},u=i.SanitizeWebUrl(u),e=t.defer(),t.when(i.GetUpdatedDigest(u)).then(function(){var t=n({url:u+"_api/web/lists/getbytitle('"+r+"')/items",method:"POST",data:f,headers:{Accept:"application/json;odata=verbose","Content-Type":"application/json;odata=verbose","X-RequestDigest":i.Support.GetCurrentDigestValue(u)}});t.then(function(n){e.resolve(i.Support.GetJustTheData(n))},function(n){e.reject(n)})}),e.promise};this.GetItemById=function(r,u,f,e){var s,o,h;return f=i.SanitizeWebUrl(f),s=f+"_api/web/lists/getbytitle('"+u+"')/items("+r+")",typeof e!="undefined"&&e!=""&&(s+="?"+e),o=t.defer(),h=n({url:s,method:"GET",headers:{Accept:"application/json; odata=verbose"}}),h.then(function(n){o.resolve(i.Support.GetJustTheData(n))},function(n){o.reject(n)}),o.promise};this.GetListItems=function(r,u,f){var s,e,o,c,h;if(u=i.SanitizeWebUrl(u),typeof f=="string"&&(f={$filter:f}),s=u+"_api/web/lists/getbytitle('"+r+"')/items",typeof f!="undefined"){e="";for(o in f)if(f.hasOwnProperty(o)){if(o==="LoadPage"){s=f[o];break}e.length==0&&(e="?");e+=o+"="+f[o]+"&"}e.lastIndexOf("&")==e.length-1&&(e=e.substring(0,e.length-1));s+=e}return c=n({url:s,method:"GET",headers:{Accept:"application/json; odata=verbose"}}),h=t.defer(),c.then(function(n){h.resolve(i.Support.GetJustTheData(n))},function(n){h.reject(n)}),h.promise};this.GetListItemsByCAML=function(r,u,f,e){var h,o,s,l,c;if(u=i.SanitizeWebUrl(u),h=u+"_api/web/lists/getbytitle('"+r+'\')/GetItems(query=@v1)?@v1={"ViewXml":"'+f+'"}',typeof e!="undefined"){o="";for(s in e)if(e.hasOwnProperty(s)){if(s==="LoadPage"){h=e[s];break}o.length==0&&(o="?");o+=s+"="+e[s]+"&"}o.lastIndexOf("&")==o.length-1&&(o=o.substring(0,o.length-1));h+=o}return l=n({url:h,method:"POST",headers:{Accept:"application/json;odata=verbose","X-RequestDigest":i.Support.GetCurrentDigestValue(u)}}),c=t.defer(),l.then(function(n){c.resolve(i.Support.GetJustTheData(n))},function(n){c.reject(n)}),c.promise};this.UpdateListItem=function(r,u,f,e){f=i.SanitizeWebUrl(f);var s=i.GetItemTypeForListName(u),o=t.defer();return t.when(i.GetUpdatedDigest(f)).then(function(){i.GetItemById(r,u,f).then(function(t){e.__metadata={type:t.__metadata.type};var r=n({url:t.__metadata.uri,method:"POST",data:JSON.stringify(e),headers:{Accept:"application/json;odata=verbose","Content-Type":"application/json;odata=verbose","X-RequestDigest":i.Support.GetCurrentDigestValue(f),"X-HTTP-Method":"MERGE","If-Match":t.__metadata.etag}});r.then(function(n){o.resolve(n)},function(n){o.reject(n)})})}),o.promise};this.DeleteListItem=function(r,u,f){f=i.SanitizeWebUrl(f);var e=t.defer();return t.when(i.GetUpdatedDigest(f)).then(function(){i.GetItemById(r,u,f).then(function(t){var r=n({url:t.__metadata.uri,method:"DELETE",headers:{Accept:"application/json;odata=verbose","X-Http-Method":"DELETE","X-RequestDigest":i.Support.GetCurrentDigestValue(f),"If-Match":t.__metadata.etag}});r.then(function(n){e.resolve(i.Support.GetJustTheData(n))},function(n){e.reject(n)})})}),e.promise};this.GetGroup=function(r,u,f){var e,o,s;return f=i.SanitizeWebUrl(f),e=f+"_api/web/sitegroups?$filter=(Title%20eq%20%27"+r+"%27)",u&&(e=e+"&$expand=Users"),o=t.defer(),s=n({url:e,method:"GET",headers:{Accept:"application/json; odata=verbose"}}),s.then(function(n){o.resolve(i.Support.GetJustTheData(n))},function(n){o.reject(n)}),o.promise};this.GetSiteUsers=function(r,u){var o,f,e,s,h;if(r=i.SanitizeWebUrl(r),o=r+"_api/web/SiteUsers",typeof u!="undefined"){f="";for(e in u)if(u.hasOwnProperty(e)){if(e==="LoadPage"){o=u[e];break}f.length==0&&(f="?");f+=e+"="+u[e]+"&"}f.lastIndexOf("&")==f.length-1&&(f=f.substring(0,f.length-1));o+=f}return s=t.defer(),h=n({url:o,method:"GET",headers:{Accept:"application/json; odata=verbose"}}),h.then(function(n){s.resolve(i.Support.GetJustTheData(n))},function(n){s.reject(n)}),s.promise};this.GetUserById=function(r,u){u=i.SanitizeWebUrl(u);var e=u+"_api/Web/GetUserById("+r+")",f=t.defer(),o=n({url:e,method:"GET",headers:{Accept:"application/json; odata=verbose"}});return o.then(function(n){f.resolve(i.Support.GetJustTheData(n))},function(n){f.reject(n)}),f.promise};this.AddUsertoGroup=function(r,u,f){f=i.SanitizeWebUrl(f);var e=t.defer();return t.when(i.GetUpdatedDigest(f)).then(function(){var t={LoginName:u},o;t.__metadata={type:"SP.User"};f=i.SanitizeWebUrl(f);o=n({url:f+"_api/web/sitegroups("+r+")/users",method:"POST",data:JSON.stringify(t),headers:{Accept:"application/json;odata=verbose","Content-Type":"application/json;odata=verbose","X-RequestDigest":i.Support.GetCurrentDigestValue(f)}});o.then(function(n){e.resolve(i.Support.GetJustTheData(n))},function(n){e.reject(n)})}),e.promise};this.GetUserId=function(n){var r=t.defer(),u=new SP.ClientContext.get_current,i=u.get_web().ensureUser(n);return u.load(i),u.executeQueryAsync(Function.createDelegate(i,function(){r.resolve(i)}),Function.createDelegate(i,function(){r.reject(i,args)})),r.promise};this.CreateSubSite=function(r,u){u=i.SanitizeWebUrl(u);var e={parameters:{__metadata:{type:"SP.WebInfoCreationInformation"},Url:r.siteUrl,Title:r.siteName,Description:r.siteDescription,Language:1033,WebTemplate:r.siteTemplate,UseUniquePermissions:r.uniquePermissions}},f=t.defer();return t.when(i.GetUpdatedDigest(u)).then(function(){n({url:u+"_api/web/webinfos/add",type:"POST",headers:{accept:"application/json;odata=verbose","content-type":"application/json;odata=verbose","X-RequestDigest":i.Support.GetCurrentDigestValue(u)},data:JSON.stringify(e)}).then(function(n){f.resolve(i.Support.GetJustTheData(n))})}),f.promise};this.GetWebData=function(r){r=i.SanitizeWebUrl(r);var f=r+"_api/web",u=t.defer(),e=n({url:f,method:"GET",headers:{Accept:"application/json; odata=verbose"}});return e.then(function(n){u.resolve(i.Support.GetJustTheData(n))},function(n){u.reject(n)}),u.promise};this.UpdateWebData=function(r,u){r=i.SanitizeWebUrl(r);var f=t.defer();return t.when(i.GetUpdatedDigest(r)).then(function(){u.__metadata={type:"SP.Web"};i.GetWebData(r).then(function(t){n({url:t.__metadata.uri,type:"POST",data:JSON.stringify(u),headers:{Accept:"application/json;odata=verbose","Content-Type":"application/json;odata=verbose","X-RequestDigest":i.Support.GetCurrentDigestValue(r),"X-HTTP-Method":"MERGE","If-Match":t.__metadata.etag}}).then(function(n){f.resolve(i.Support.GetJustTheData(n))},function(n){f.reject(n)})})}),f.promise};this.AddFileToLibrary=function(r,u,f,e){u=i.SanitizeWebUrl(u);var s=u+"_api/web/lists/getByTitle(@TargetLibrary)/RootFolder/Files/add(url=@TargetFileName,overwrite='true')?@TargetLibrary='"+r+"'&@TargetFileName='"+f+"'",o=t.defer();return t.when(i.GetUpdatedDigest(u)).then(function(){var t=n({url:s,method:"POST",transformRequest:[],data:e,headers:{Accept:"application/json; odata=verbose","X-RequestDigest":i.Support.GetCurrentDigestValue(u)}});t.then(function(n){o.resolve(i.Support.GetJustTheData(n))},function(n){o.reject(n)})}),o.promise};this.Search={Get:function(r,u){var s,f,e,o,h;r=i.SanitizeWebUrl(r);s=r+"_api/search/query";f="";for(e in u)u.hasOwnProperty(e)&&(f.length==0&&(f="?"),f+=e+"=",f+=typeof u[e]=="number"||typeof u[e]=="boolean"?""+u[e]:"'"+u[e]+"'",f+="&");return f.lastIndexOf("&")==f.length-1&&(f=f.substring(0,f.length-1)),s+=f,o=t.defer(),h=n({url:s,method:"GET",headers:{Accept:"application/json; odata=verbose"}}),h.then(function(n){o.resolve(i.Search.GetReturnFromResponse(n))},function(n){o.reject(n)}),o.promise},Post:function(){},GetReturnFromResponse:function(n){return{ElapsedTime:n.data.d.query.ElapsedTime,PrimaryQueryResult:{RefinementResults:i.Search.GetArrayFromResultList(n.data.d.query.PrimaryQueryResult.RefinementResults),RelevantResults:i.Search.GetArrayFromResultList(n.data.d.query.PrimaryQueryResult.RelevantResults),SpecialTermResults:i.Search.GetArrayFromResultList(n.data.d.query.PrimaryQueryResult.SpecialTermResults)},SpellingSuggestion:n.data.d.query.SpellingSuggestion}},GetArrayFromResultList:function(n){var f,u,i,r,t;if(n===null)return null;for(f={Results:[],RowCount:n.RowCount},u=0;u<n.Table.Rows.results.length;u++){for(i=n.Table.Rows.results[u],r={},t=0;t<i.Cells.results.length;t++)switch(i.Cells.results[t].ValueType){case"Edm.Double":case"Edm.Int64":r[i.Cells.results[t].Key]=Number(i.Cells.results[t].Value);break;case"Edm.DateTime":r[i.Cells.results[t].Key]=new Date(i.Cells.results[t].Value);break;case"Edm.Boolean":r[i.Cells.results[t].Key]=i.Cells.results[t].Value==="true";break;default:r[i.Cells.results[t].Key]=i.Cells.results[t].Value}f.Results.push(r)}return f}};this.Profile={GetCurrentUser:function(r,u){var o,f,e,h,s;if(r=i.SanitizeWebUrl(r),o=r+"_api/SP.UserProfiles.PeopleManager/GetMyProperties",typeof u!="undefined"){f="";for(e in u)if(u.hasOwnProperty(e)){if(e==="LoadPage"){o=u[e];break}f.length==0&&(f="?");f+=e+"="+u[e]+"&"}f.lastIndexOf("&")==f.length-1&&(f=f.substring(0,f.length-1));o+=f}return h=n({url:o,method:"GET",headers:{Accept:"application/json; odata=verbose"}}),s=t.defer(),h.then(function(n){s.resolve(i.Support.GetJustTheData(n))},function(n){s.reject(n)}),s.promise},GetForUser:function(r,u,f){var s,e,o,c,h;if(r=i.SanitizeWebUrl(r),s=r+"_api/SP.UserProfiles.PeopleManager/GetPropertiesFor(accountName=@v)?@v='"+u+"'",typeof f!="undefined"){e="";for(o in f)if(f.hasOwnProperty(o)){if(o==="LoadPage"){s=f[o];break}e.length==0&&(e="?");e+=o+"="+f[o]+"&"}e.lastIndexOf("&")==e.length-1&&(e=e.substring(0,e.length-1));s+=e}return c=n({url:s,method:"GET",headers:{Accept:"application/json; odata=verbose"}}),h=t.defer(),c.then(function(n){h.resolve(i.Support.GetJustTheData(n))},function(n){h.reject(n)}),h.promise}}}]);angularSP.service("AngularSPCSOM",["$q",function(n){var t=this;this.GetItemTypeForListName=function(n){return"SP.Data."+n.charAt(0).toUpperCase()+n.split(" ").join("").slice(1)+"ListItem"};this.SanitizeWebUrl=function(n){return(typeof n=="undefined"||n==null||n=="")&&(n=_spPageContextInfo.siteAbsoluteUrl),n};this.CreateListItem=function(i,r,u){var h,f,o;r=t.SanitizeWebUrl(r);var e=new SP.ClientContext(r),c=e.get_web().get_lists().getByTitle(i),l=new SP.ListItemCreationInformation,s=c.addItem(l);for(h in u)s.set_item(h,u[h]);return s.update(),f={Context:e,List:c,ListItem:s},e.load(f.ListItem),o=n.defer(),e.executeQueryAsync(Function.createDelegate(f,function(){o.resolve(f.ListItem.get_fieldValues())}),Function.createDelegate(f,function(n,t){o.reject(t)})),o.promise};this.GetItemById=function(i,r,u){var f;u=t.SanitizeWebUrl(u);var e=new SP.ClientContext(u),s=e.get_web().get_lists().getByTitle(r),o=s.getItemById(i);return e.load(o),f=n.defer(),e.executeQueryAsync(function(){f.resolve(o.get_fieldValues())},function(n,t){f.reject(t)}),f.promise};this.GetArrayFromJSOMEnumerator=function(n){for(var t=n.getEnumerator(),i=[],r;t.moveNext();)r=t.get_current(),i.push(r.get_fieldValues());return i};this.GetListItems=function(i,r,u){var f,o;r=t.SanitizeWebUrl(r);var e=new SP.ClientContext(r),s=e.get_web().get_lists().getByTitle(i),h=new SP.CamlQuery;return typeof u!="undefined"&&h.set_viewXml(u),f={Context:e,List:s},f.collListItem=s.getItems(h),o=n.defer(),e.load(f.collListItem),e.executeQueryAsync(Function.createDelegate(f,function(){var n=t.GetArrayFromJSOMEnumerator(f.collListItem);o.resolve(n)}),Function.createDelegate(this,function(n,t){o.reject(t)})),o.promise};this.UpdateListItem=function(i,r,u,f){var c,e,o;u=t.SanitizeWebUrl(u);var s=new SP.ClientContext(u),l=s.get_web().get_lists().getByTitle(r),h=l.getItemById(i);for(c in f)h.set_item(c,f[c]);return h.update(),e={Context:s,List:l,ListItem:h},o=n.defer(),s.executeQueryAsync(Function.createDelegate(e,function(){o.resolve(e.ListItem.get_fieldValues())}),Function.createDelegate(e,function(n,t){o.reject(t)})),o.promise};this.DeleteListItem=function(i,r,u){var f;u=t.SanitizeWebUrl(u);var e=new SP.ClientContext(u),o=e.get_web().get_lists().getByTitle(r),s=o.getItemById(i);return s.deleteObject(),f=n.defer(),e.executeQueryAsync(function(){f.resolve()},function(n,t){f.reject(t)}),f.promise};this.GetGroup=function(n,i,r){r=t.SanitizeWebUrl(r);throw{name:"GetGroup",level:"Not Implemented",message:"Not Implemented",htmlMessage:"Not Implemented",toString:function(){return this.name+": "+this.message}};};this.GetSiteUsers=function(n){n=t.SanitizeWebUrl(n);throw{name:"GetSiteUsers",level:"Not Implemented",message:"Not Implemented",htmlMessage:"Not Implemented",toString:function(){return this.name+": "+this.message}};};this.GetUserById=function(n,i){i=t.SanitizeWebUrl(i);throw{name:"GetUserById",level:"Not Implemented",message:"Not Implemented",htmlMessage:"Not Implemented",toString:function(){return this.name+": "+this.message}};};this.AddUsertoGroup=function(n,i,r){r=t.SanitizeWebUrl(r);throw{name:"AddUsertoGroup",level:"Not Implemented",message:"Not Implemented",htmlMessage:"Not Implemented",toString:function(){return this.name+": "+this.message}};};this.GetUserId=function(i,r){r=t.SanitizeWebUrl(r);var u=n.defer(),f=new SP.ClientContext(r),e=f.get_web().ensureUser(i);return f.load(e),f.executeQueryAsync(function(){u.resolve(e)},function(n,t){u.reject(e,t)}),u.promise};this.CreateSubSite=function(i,r){r=t.SanitizeWebUrl(r);throw{name:"CreateSubSite",level:"Not Implemented",message:"Not Implemented",htmlMessage:"Not Implemented",toString:function(){return this.name+": "+this.message}};var f,e,u};this.GetWebData=function(n){n=t.SanitizeWebUrl(n);throw{name:"GetWebData",level:"Not Implemented",message:"Not Implemented",htmlMessage:"Not Implemented",toString:function(){return this.name+": "+this.message}};};this.UpdateWebData=function(i,r){i=t.SanitizeWebUrl(i);throw{name:"UpdateWebData",level:"Not Implemented",message:"Not Implemented",htmlMessage:"Not Implemented",toString:function(){return this.name+": "+this.message}};var f,u};this.Search=function(i,r){var f,u,h,o,e;if(i=t.SanitizeWebUrl(i),f=new SP.ClientContext(i),u=new Microsoft.SharePoint.Client.Search.Query.KeywordQuery(f),typeof r.querytext!="undefined"&&u.set_queryText(r.querytext),typeof r.rowlimit!="undefined"&&u.set_rowLimit(r.rowlimit),typeof r.trimduplicates!="undefined"&&u.set_trimDuplicates(r.trimduplicates),typeof r.sortlist!="undefined"&&u.set_sortList(r.sortlist),typeof r.querytemplate!="undefined"&&u.set_queryTemplate(r.querytemplate),typeof r.enableinterleaving!="undefined"&&u.set_enableInterleaving(r.enableinterleaving),typeof r.sourceid!="undefined"&&u.set_sourceId(r.sourceid),typeof r.rankingmodelid!="undefined"&&u.set_rankingModelId(r.rankingmodelid),typeof r.startrow!="undefined"&&u.set_startRow(r.startrow),typeof r.rowsperpage!="undefined"&&u.set_rowsPerPage(r.rowsperpage),typeof r.selectproperties!="undefined")for(h=u.get_selectProperties(),o=[].concat(r.selectproperties),e=0;e<o.length;e++)h.add(o[e]);typeof r.trimduplicates!="undefined"&&u.set_trimDuplicates(r.trimduplicates);typeof r.trimduplicates!="undefined"&&u.set_trimDuplicates(r.trimduplicates);typeof r.trimduplicates!="undefined"&&u.set_trimDuplicates(r.trimduplicates);typeof r.trimduplicates!="undefined"&&u.set_trimDuplicates(r.trimduplicates);typeof r.trimduplicates!="undefined"&&u.set_trimDuplicates(r.trimduplicates);typeof r.trimduplicates!="undefined"&&u.set_trimDuplicates(r.trimduplicates);typeof r.trimduplicates!="undefined"&&u.set_trimDuplicates(r.trimduplicates);typeof r.trimduplicates!="undefined"&&u.set_trimDuplicates(r.trimduplicates);typeof r.trimduplicates!="undefined"&&u.set_trimDuplicates(r.trimduplicates);typeof r.trimduplicates!="undefined"&&u.set_trimDuplicates(r.trimduplicates);typeof r.trimduplicates!="undefined"&&u.set_trimDuplicates(r.trimduplicates);typeof r.trimduplicates!="undefined"&&u.set_trimDuplicates(r.trimduplicates);typeof r.trimduplicates!="undefined"&&u.set_trimDuplicates(r.trimduplicates);typeof r.trimduplicates!="undefined"&&u.set_trimDuplicates(r.trimduplicates);typeof r.trimduplicates!="undefined"&&u.set_trimDuplicates(r.trimduplicates);typeof r.trimduplicates!="undefined"&&u.set_trimDuplicates(r.trimduplicates);typeof r.trimduplicates!="undefined"&&u.set_trimDuplicates(r.trimduplicates);typeof r.trimduplicates!="undefined"&&u.set_trimDuplicates(r.trimduplicates);typeof r.trimduplicates!="undefined"&&u.set_trimDuplicates(r.trimduplicates);var l=new Microsoft.SharePoint.Client.Search.Query.SearchExecutor(f),a=l.executeQuery(u),c={results:a},s=n.defer();return f.executeQueryAsync(Function.createDelegate(c,function(){var n={ElapsedTime:this.results.m_value.ElapsedTime,PrimaryQueryResult:{RefinementResults:[],RelevantResults:[],SpecialTermResults:[]},SpellingSuggestion:this.results.m_value.SpellingSuggestion},t=this.results;$.each(t.m_value.ResultTables,function(i,r){r.TableType=="RelevantResults"?n.PrimaryQueryResult.RelevantResults=t.m_value.ResultTables[i].ResultRows:r.TableType=="RefinementResults"?n.PrimaryQueryResult.RefinementResults=t.m_value.ResultTables[i].ResultRows:r.TableType=="SpecialTermResults"&&(n.PrimaryQueryResult.SpecialTermResults=t.m_value.ResultTables[i].ResultRows)});s.resolve(n)}),Function.createDelegate(c,function(n,t){s.reject(t)})),s.promise}}]);
//# sourceMappingURL=AngularSP.min.js.map
