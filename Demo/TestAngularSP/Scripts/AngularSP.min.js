var angularSP=angular.module("AngularSP",[]);angularSP.service("AngularSPREST",["$http","$q",function(n,t){var i=this,r=[];this.GetUpdatedDigest=function(u,f){var o=t.defer(),s,e,h;return u=i.SanitizeWebUrl(u),s=!1,e=i.Support.GetDigestFromCache(u,f),s=e===null,e!=null&&e.digestData!=null&&e.digestExpires.getTime()>(new Date).getTime()?o.resolve(e.digestData):h=n({url:u+"_api/contextinfo",method:"POST",headers:{Accept:"application/json; odata=verbose"}}).then(function(n){s&&(e={digestData:null,digestExpires:null,webUrl:u+f},r.push(e));e.digestData=i.Support.GetJustTheData(n).GetContextWebInformation;var t=e.digestData.FormDigestTimeoutSeconds,h=new Date;e.digestExpires=new Date(h.getTime()+t*1e3);o.resolve(e.digestData)},function(n,t){console.log("Error getting new digest");o.reject(t)}),o.promise};this.GetItemTypeForListName=function(n){return n=n.replace(/_/g,"_x005f_").replace(/-/g,""),"SP.Data."+n.charAt(0).toUpperCase()+n.split(" ").join("").slice(1)+"ListItem"};this.GetUrlPrefix=function(){i.IsSharePointHostedApp};this.Support={Guid:new RegExp("^({{0,1}([0-9a-fA-F]){8}-([0-9a-fA-F]){4}-([0-9a-fA-F]){4}-([0-9a-fA-F]){4}-([0-9a-fA-F]){12}}{0,1})$"),GetJustTheData:function(n){var t=n;return typeof t.data!="undefined"&&(t=t.data),typeof t.d!="undefined"&&(t=t.d),typeof t.results!="undefined"&&(t=t.results),t},EndsWith:function(n,t){return n.indexOf(t,n.length-t.length)!==-1},GetCurrentDigestValue:function(n,t){n=i.SanitizeWebUrl(n);var r=i.Support.GetDigestFromCache(n,t);return r!=null&&r.digestData!=null&&r.digestExpires.getTime()>(new Date).getTime()?r.digestData.FormDigestValue:$("#__REQUESTDIGEST").val()},GetDigestFromCache:function(n,t){for(var i=0;i<r.length;i++)if(r[i].webUrl==n+t)return r[i];return null},SendRequestViaExecutor:function(n,i,r,u,f,e){var c,s,o,h;if((typeof f=="undefined"||f===null)&&(f="GET"),c=new SP.RequestExecutor(i),s={promise:t.defer()},n+=n.indexOf("?")>0?"&":"?",o={url:i+"_api/SP.AppContextSite(@target)"+n+"@target='"+r+"'",method:f,headers:{Accept:"application/json; odata=verbose"},success:Function.createDelegate(s,function(n){n.body===""&&(n.body="{}");this.promise.resolve(JSON.parse(n.body))}),error:Function.createDelegate(s,function(n){n.body===""&&(n.body="{}");this.promise.reject(JSON.parse(n.body))})},typeof e!="undefined")for(h in e)e.hasOwnProperty(h)&&(o.headers[h]=e[h]);return typeof u!="undefined"&&u!=null&&(o.body=JSON.stringify(u),o.headers["content-type"]="application/json;odata=verbose"),c.executeAsync(o),s.promise.promise}};this.SanitizeWebUrl=function(n){return(typeof n=="undefined"||n==null||n=="")&&(n=_spPageContextInfo.siteAbsoluteUrl),n.endsWith("/")===!1&&(n+="/"),n};this.CreateListItem=function(r,u,f,e){var h=i.GetItemTypeForListName(r),s="/web/lists/getbytitle('"+r+"')/items",o;return f.__metadata={type:h},u=i.SanitizeWebUrl(u),o=t.defer(),t.when(i.GetUpdatedDigest(u)).then(function(){var t;t=typeof e=="undefined"||e===null||e===""?n({url:u+"_api"+s,method:"POST",data:f,headers:{Accept:"application/json;odata=verbose","Content-Type":"application/json;odata=verbose","X-RequestDigest":i.Support.GetCurrentDigestValue(u)}}):i.Support.SendRequestViaExecutor(s,u,e,f,"POST");t.then(function(n){o.resolve(i.Support.GetJustTheData(n))},function(n){o.reject(n)})}),o.promise};this.GetItemById=function(r,u,f,e,o){var s,h,c;return f=i.SanitizeWebUrl(f),s="/web/lists",i.Support.Guid.test(u)?(u=u.replace(/\{|\}/gi,""),s+="(guid'"+u+"')"):s+="/getbytitle('"+u+"')",s+="/items("+r+")",typeof e!="undefined"&&e!=""&&(s+="?"+e),h=t.defer(),typeof o=="undefined"||o===null||o===""?(s=f+"_api"+s,c=n({url:s,method:"GET",headers:{Accept:"application/json; odata=verbose"}})):c=i.Support.SendRequestViaExecutor(s,f,o,null,"GET"),c.then(function(n){h.resolve(i.Support.GetJustTheData(n))},function(n){h.reject(n)}),h.promise};this.GetListItems=function(r,u,f,e){var o,s,h,l,c;if(u=i.SanitizeWebUrl(u),typeof f=="string"&&(f={$filter:f}),o="/web/lists",i.Support.Guid.test(r)?(r=r.replace(/\{|\}/gi,""),o+="(guid'"+r+"')"):o+="/getbytitle('"+r+"')",o+="/items",typeof f!="undefined"){s="";for(h in f)if(f.hasOwnProperty(h)){if(h==="LoadPage"){o=f[h];break}s.length==0&&(s="?");s+=h+"="+f[h]+"&"}s.lastIndexOf("&")==s.length-1&&(s=s.substring(0,s.length-1));o+=s}return typeof e=="undefined"||e===null?(o=u+"_api"+o,l=n({url:o,method:"GET",headers:{Accept:"application/json; odata=verbose"}})):l=i.Support.SendRequestViaExecutor(o,u,e,null,"GET"),c=t.defer(),l.then(function(n){c.resolve(i.Support.GetJustTheData(n))},function(n){c.reject(n)}),c.promise};this.GetList=function(r,u,f,e){var s,o,h,l,c;if(u=i.SanitizeWebUrl(u),typeof f=="string"&&(f={$filter:f}),s="/web/lists",i.Support.Guid.test(r)?(r=r.replace(/\{|\}/gi,""),s+="(guid'"+r+"')"):s+="/getbytitle('"+r+"')",typeof f!="undefined"){o="";for(h in f)if(f.hasOwnProperty(h)){if(h==="LoadPage"){s=f[h];break}o.length==0&&(o="?");o+=h+"="+f[h]+"&"}o.lastIndexOf("&")==o.length-1&&(o=o.substring(0,o.length-1));s+=o}return typeof e=="undefined"||e===null?(s=u+"_api"+s,l=n({url:s,method:"GET",headers:{Accept:"application/json; odata=verbose"}})):l=i.Support.SendRequestViaExecutor(s,u,e,null,"GET"),c=t.defer(),l.then(function(n){c.resolve(i.Support.GetJustTheData(n))},function(n){c.reject(n)}),c.promise};this.GetListItemsByCAML=function(r,u,f,e,o){var s,h,c,a,l;if(u=i.SanitizeWebUrl(u),s="/web/lists",i.Support.Guid.test(r)?(r=r.replace(/\{|\}/gi,""),s+="(guid'"+r+"')"):s+="/getbytitle('"+r+"')",s+='/GetItems(query=@v1)?@v1={"ViewXml":"'+f+'"}',typeof e!="undefined"){h="";for(c in e)if(e.hasOwnProperty(c)){if(c==="LoadPage"){s=e[c];break}h.length==0&&(h="?");h+=c+"="+e[c]+"&"}h.lastIndexOf("&")==h.length-1&&(h=h.substring(0,h.length-1));s+=h}return typeof o=="undefined"||o===null||o===""?(s=u+"_api"+s,a=n({url:s,method:"POST",headers:{Accept:"application/json;odata=verbose","X-RequestDigest":i.Support.GetCurrentDigestValue(u)}})):a=i.Support.SendRequestViaExecutor(s,u,o,null,"POST"),l=t.defer(),a.then(function(n){l.resolve(i.Support.GetJustTheData(n))},function(n){l.reject(n)}),l.promise};this.UpdateListItem=function(r,u,f,e,o){f=i.SanitizeWebUrl(f);var h=i.GetItemTypeForListName(u),s=t.defer();return t.when(i.GetUpdatedDigest(f)).then(function(){i.GetItemById(r,u,f,null,o).then(function(t){var h,c,l;e.__metadata={type:t.__metadata.type};typeof o=="undefined"||o===null||o===""?h=n({url:t.__metadata.uri,method:"POST",data:JSON.stringify(e),headers:{Accept:"application/json;odata=verbose","Content-Type":"application/json;odata=verbose","X-RequestDigest":i.Support.GetCurrentDigestValue(f),"X-HTTP-Method":"MERGE","If-Match":t.__metadata.etag}}):(c="/web/lists/getbytitle('"+u+"')/items("+r+")",l={"X-HTTP-Method":"MERGE","If-Match":t.__metadata.etag},h=i.Support.SendRequestViaExecutor(c,f,o,e,"POST",l));h.then(function(n){s.resolve(n)},function(n){s.reject(n)})})}),s.promise};this.DeleteListItem=function(r,u,f,e){f=i.SanitizeWebUrl(f);var o=t.defer();return t.when(i.GetUpdatedDigest(f)).then(function(){i.GetItemById(r,u,f,null,e).then(function(t){var s,h,c;typeof e=="undefined"||e===null||e===""?s=n({url:t.__metadata.uri,method:"DELETE",headers:{Accept:"application/json;odata=verbose","X-Http-Method":"DELETE","X-RequestDigest":i.Support.GetCurrentDigestValue(f),"If-Match":t.__metadata.etag}}):(h={"X-HTTP-Method":"DELETE","If-Match":t.__metadata.etag},c="/web/lists/getbytitle('"+u+"')/items("+r+")",s=i.Support.SendRequestViaExecutor(c,f,e,null,"DELETE",h));s.then(function(n){o.resolve(i.Support.GetJustTheData(n))},function(n){o.reject(n)})})}),o.promise};this.GetGroup=function(r,u,f,e){var o,s,h;return f=i.SanitizeWebUrl(f),o="/web/sitegroups?$filter=(Title%20eq%20%27"+r+"%27)",u&&(o=o+"&$expand=Users"),s=t.defer(),typeof e=="undefined"||e===null||e===""?(o=f+"_api"+o,h=n({url:o,method:"GET",headers:{Accept:"application/json; odata=verbose"}})):h=i.Support.SendRequestViaExecutor(o,f,e,null,"GET"),h.then(function(n){s.resolve(i.Support.GetJustTheData(n))},function(n){s.reject(n)}),s.promise};this.GetSiteUsers=function(r,u,f){var o,e,s,h,c;if(r=i.SanitizeWebUrl(r),o="/web/SiteUsers",typeof u!="undefined"){e="";for(s in u)if(u.hasOwnProperty(s)){if(s==="LoadPage"){o=u[s];break}e.length==0&&(e="?");e+=s+"="+u[s]+"&"}e.lastIndexOf("&")==e.length-1&&(e=e.substring(0,e.length-1));o+=e}return h=t.defer(),typeof f=="undefined"||f===null||f===""?(o=r+"_api"+o,c=n({url:o,method:"GET",headers:{Accept:"application/json; odata=verbose"}})):c=i.Support.SendRequestViaExecutor(o,r,f,null,"GET"),c.then(function(n){h.resolve(i.Support.GetJustTheData(n))},function(n){h.reject(n)}),h.promise};this.GetListViews=function(r,u,f){var e,o,s;return u=i.SanitizeWebUrl(u),e="/web/lists",i.Support.Guid.test(r)?(r=r.replace(/\{|\}/gi,""),e+="(guid'"+r+"')"):e+="/getbytitle('"+r+"')",e+="/Views?$expand=ViewFields",o=t.defer(),typeof f=="undefined"||f===null||f===""?(e=u+"_api"+e,s=n({url:e,method:"GET",headers:{Accept:"application/json; odata=verbose"}})):s=i.Support.SendRequestViaExecutor(e,u,f,null,"GET"),s.then(function(n){o.resolve(i.Support.GetJustTheData(n))},function(n){o.reject(n)}),o.promise};this.GetDefaultViewByList=function(r,u,f){var e,o,s;return u=i.SanitizeWebUrl(u),e="/web/lists",i.Support.Guid.test(r)?(r=r.replace(/\{|\}/gi,""),e+="(guid'"+r+"')"):e+="/getbytitle('"+r+"')",e+="/Views?$expand=ViewFields&$filter=DefaultView eq true",o=t.defer(),typeof f=="undefined"||f===null||f===""?(e=u+"_api"+e,s=n({url:e,method:"GET",headers:{Accept:"application/json; odata=verbose"}})):s=i.Support.SendRequestViaExecutor(e,u,f,null,"GET"),s.then(function(n){o.resolve(i.Support.GetJustTheData(n)[0])},function(n){o.reject(n)}),o.promise};this.GetListFieldProperties=function(r,u,f){var e,o,s;return u=i.SanitizeWebUrl(u),e="/web/lists",i.Support.Guid.test(r)?(r=r.replace(/\{|\}/gi,""),e+="(guid'"+r+"')"):e+="/getbytitle('"+r+"')",e+="/Fields",o=t.defer(),typeof f=="undefined"||f===null||f===""?(e=u+"_api"+e,s=n({url:e,method:"GET",headers:{Accept:"application/json; odata=verbose"}})):s=i.Support.SendRequestViaExecutor(e,u,f,null,"GET"),s.then(function(n){o.resolve(i.Support.GetJustTheData(n))},function(n){o.reject(n)}),o.promise};this.GetGroupsByUserId=function(r,u,f){u=i.SanitizeWebUrl(u);var e=u+"_api/Web/GetUserById("+r+")?$expand=Groups",o=t.defer(),s;return typeof f=="undefined"||f===null||f===""?(e=u+"_api"+e,s=n({url:e,method:"GET",headers:{Accept:"application/json; odata=verbose"}})):s=i.Support.SendRequestViaExecutor(e,u,f,null,"GET"),s.then(function(n){o.resolve(i.Support.GetJustTheData(n))},function(n){o.reject(n)}),o.promise};this.GetUserById=function(r,u,f){u=i.SanitizeWebUrl(u);var e="/Web/GetUserById("+r+")",o=t.defer(),s;return typeof f=="undefined"||f===null||f===""?(e=u+"_api"+e,s=n({url:e,method:"GET",headers:{Accept:"application/json; odata=verbose"}})):s=i.Support.SendRequestViaExecutor(e,u,f,null,"GET"),s.then(function(n){o.resolve(i.Support.GetJustTheData(n))},function(n){o.reject(n)}),o.promise};this.AddUsertoGroup=function(r,u,f,e){f=i.SanitizeWebUrl(f);var o=t.defer();return t.when(i.GetUpdatedDigest(f)).then(function(){var h={LoginName:u},t,s;h.__metadata={type:"SP.User"};f=i.SanitizeWebUrl(f);t="/web/sitegroups("+r+")/users";typeof e=="undefined"||e===null||e===""?(t=f+"_api"+t,s=n({url:t,method:"POST",data:JSON.stringify(h),headers:{Accept:"application/json;odata=verbose","Content-Type":"application/json;odata=verbose","X-RequestDigest":i.Support.GetCurrentDigestValue(f)}})):s=i.Support.SendRequestViaExecutor(t,f,e,null,"POST");s.then(function(n){o.resolve(i.Support.GetJustTheData(n))},function(n){o.reject(n)})}),o.promise};this.GetUserId=function(n){var r=t.defer(),u=new SP.ClientContext.get_current,i=u.get_web().ensureUser(n);return u.load(i),u.executeQueryAsync(Function.createDelegate(i,function(){r.resolve(i)}),Function.createDelegate(i,function(){r.reject(i,args)})),r.promise};this.CreateSubSite=function(r,u,f){u=i.SanitizeWebUrl(u);var e={parameters:{__metadata:{type:"SP.WebInfoCreationInformation"},Url:r.siteUrl,Title:r.siteName,Description:r.siteDescription,Language:1033,WebTemplate:r.siteTemplate,UseUniquePermissions:r.uniquePermissions}},o=t.defer();return t.when(i.GetUpdatedDigest(u)).then(function(){var t="/web/webinfos/add",r;typeof f=="undefined"||f===null||f===""?(t=u+"_api"+t,r=n({url:t,type:"POST",headers:{accept:"application/json;odata=verbose","content-type":"application/json;odata=verbose","X-RequestDigest":i.Support.GetCurrentDigestValue(u)},data:JSON.stringify(e)})):r=i.Support.SendRequestViaExecutor(t,u,f,e,"POST");r.then(function(n){o.resolve(i.Support.GetJustTheData(n))})}),o.promise};this.GetWebData=function(r,u){r=i.SanitizeWebUrl(r);var e=r+"_api/web",f=t.defer(),o;return o=typeof u=="undefined"||u===null||u===""?n({url:e,method:"GET",headers:{Accept:"application/json; odata=verbose"}}):i.Support.SendRequestViaExecutor(e,r,u,null,"GET"),o.then(function(n){f.resolve(i.Support.GetJustTheData(n))},function(n){f.reject(n)}),f.promise};this.UpdateWebData=function(r,u,f){r=i.SanitizeWebUrl(r);var e=t.defer();return t.when(i.GetUpdatedDigest(r)).then(function(){u.__metadata={type:"SP.Web"};i.GetWebData(r,f).then(function(t){var o,s;typeof f=="undefined"||f===null||f===""?o=n({url:t.__metadata.uri,type:"POST",data:JSON.stringify(u),headers:{Accept:"application/json;odata=verbose","Content-Type":"application/json;odata=verbose","X-RequestDigest":i.Support.GetCurrentDigestValue(r),"X-HTTP-Method":"MERGE","If-Match":t.__metadata.etag}}):(s={"X-HTTP-Method":"DELETE","If-Match":t.__metadata.etag},o=i.Support.SendRequestViaExecutor(t.__metadata.uri,r,f,u,"POST",s));o.then(function(n){e.resolve(i.Support.GetJustTheData(n))},function(n){e.reject(n)})})}),e.promise};this.AddFileToLibrary=function(r,u,f,e){u=i.SanitizeWebUrl(u);var s=u+"_api/web/lists/getByTitle(@TargetLibrary)/RootFolder/Files/add(url=@TargetFileName,overwrite='true')?@TargetLibrary='"+r+"'&@TargetFileName='"+f+"'",o=t.defer();return t.when(i.GetUpdatedDigest(u)).then(function(){var t;t=n({url:s,method:"POST",transformRequest:[],data:e,headers:{Accept:"application/json; odata=verbose","X-RequestDigest":i.Support.GetCurrentDigestValue(u)}});t.then(function(n){o.resolve(i.Support.GetJustTheData(n))},function(n){o.reject(n)})}),o.promise};this.AddFileToFolderInLibrary=function(r,u,f,e,o){r=i.SanitizeWebUrl(r);var s=r+"_api/web/getfolderbyserverrelativeurl('"+f+"')/files/add(overwrite=true,url='"+u+"')",h=t.defer();return t.when(i.GetUpdatedDigest(r)).then(function(){var t;typeof o=="undefined"||o===null||o===""?(s=r+"_api"+s,t=n({url:s,method:"POST",transformRequest:[],data:e,headers:{Accept:"application/json; odata=verbose","X-RequestDigest":i.Support.GetCurrentDigestValue(r)}})):t=i.Support.SendRequestViaExecutor(s,r,o,e,"POST");t.then(function(n){h.resolve(i.Support.GetJustTheData(n))},function(n){h.reject(n)})}),h.promise};this.GetFilesFromFolder=function(r,u,f){r=i.SanitizeWebUrl(r);var o=r+"_api/web/GetFolderByServerRelativeUrl('"+u+"')/Files?$expand=Author",e=t.defer();return t.when(i.GetUpdatedDigest(r)).then(function(){var t;t=typeof f=="undefined"||f===null||f===""?n({url:o,method:"GET",transformRequest:[],headers:{Accept:"application/json; odata=verbose","X-RequestDigest":i.Support.GetCurrentDigestValue(r)}}):i.Support.SendRequestViaExecutor(o,r,f,null,"GET");t.then(function(n){e.resolve(i.Support.GetJustTheData(n))},function(n){e.reject(n)})}),e.promise};this.DeleteFileFromFolder=function(r,u,f){r=i.SanitizeWebUrl(r);var o=r+"_api/web/GetFileByServerRelativeUrl('"+u+"')",e=t.defer();return t.when(i.GetUpdatedDigest(r)).then(function(){var t;t=typeof f=="undefined"||f===null||f===""?n({url:o,method:"DELETE",transformRequest:[],headers:{Accept:"application/json;odata=verbose","X-Http-Method":"DELETE","X-RequestDigest":i.Support.GetCurrentDigestValue(r),"IF-MATCH":"*"}}):i.Support.SendRequestViaExecutor(o,r,f,null,"DELETE");t.then(function(n){e.resolve(i.Support.GetJustTheData(n))},function(n){e.reject(n)})}),e.promise};this.SendEmail=function(r,u,f,e,o,s){o=i.SanitizeWebUrl(o);var c=o+"_api/SP.Utilities.Utility.SendEmail",l={properties:{__metadata:{type:"SP.Utilities.EmailProperties"},From:r,To:{results:[u]},Body:f,Subject:e}},h=t.defer();return t.when(i.GetUpdatedDigest(o)).then(function(){var t;t=typeof s=="undefined"||s===null||s===""?n({url:c,method:"POST",transformRequest:[],headers:{Accept:"application/json;odata=verbose","X-Http-Method":"POST","X-RequestDigest":i.Support.GetCurrentDigestValue(o),"IF-MATCH":"*"}}):i.Support.SendRequestViaExecutor(c,o,s,l,"POST");t.then(function(n){h.resolve(i.Support.GetJustTheData(n))},function(n){h.reject(n)})}),h.promise};this.APIGet=function(r,u,f,e){var s,o,h,l,c;if(r=i.SanitizeWebUrl(r),typeof f=="string"&&(f={$filter:f}),s=u,typeof f!="undefined"){o="";for(h in f)if(f.hasOwnProperty(h)){if(h==="LoadPage"){s=f[h];break}o.length==0&&(o="?");o+=h+"="+f[h]+"&"}o.lastIndexOf("&")==o.length-1&&(o=o.substring(0,o.length-1));s+=o}return typeof e=="undefined"||e===null?(s=r+s,l=n({url:s,method:"GET",headers:{Accept:"application/json; odata=verbose"}})):l=i.Support.SendRequestViaExecutor(s,r,e,null,"GET"),c=t.defer(),l.then(function(n){c.resolve(i.Support.GetJustTheData(n))},function(n){c.reject(n)}),c.promise};this.APIWithData=function(r,u,f,e,o){r=i.SanitizeWebUrl(r);var h=i.GetItemTypeForListName(listName),s=t.defer();return t.when(i.GetUpdatedDigest(r)).then(function(){i.GetItemById(itemId,listName,r,null,o).then(function(t){var u,f,e;updateData.__metadata={type:t.__metadata.type};typeof o=="undefined"||o===null||o===""?u=n({url:t.__metadata.uri,method:"POST",data:JSON.stringify(updateData),headers:{Accept:"application/json;odata=verbose","Content-Type":"application/json;odata=verbose","X-RequestDigest":i.Support.GetCurrentDigestValue(r),"X-HTTP-Method":"MERGE","If-Match":t.__metadata.etag}}):(f="/web/lists/getbytitle('"+listName+"')/items("+itemId+")",e={"X-HTTP-Method":"MERGE","If-Match":t.__metadata.etag},u=i.Support.SendRequestViaExecutor(f,r,o,updateData,"POST",e));u.then(function(n){s.resolve(n)},function(n){s.reject(n)})})}),s.promise};this.Search={Get:function(r,u){var s,f,e,o,h;r=i.SanitizeWebUrl(r);s=r+"_api/search/query";f="";for(e in u)u.hasOwnProperty(e)&&(f.length==0&&(f="?"),f+=e+"=",f+=typeof u[e]=="number"||typeof u[e]=="boolean"?""+u[e]:"'"+u[e]+"'",f+="&");return f.lastIndexOf("&")==f.length-1&&(f=f.substring(0,f.length-1)),s+=f,o=t.defer(),h=n({url:s,method:"GET",headers:{Accept:"application/json; odata=verbose"}}),h.then(function(n){o.resolve(i.Search.GetReturnFromResponse(n))},function(n){o.reject(n)}),o.promise},Post:function(){},GetReturnFromResponse:function(n){return{ElapsedTime:n.data.d.query.ElapsedTime,PrimaryQueryResult:{RefinementResults:i.Search.GetArrayFromRefiners(n.data.d.query.PrimaryQueryResult.RefinementResults),RelevantResults:i.Search.GetArrayFromResultList(n.data.d.query.PrimaryQueryResult.RelevantResults),SpecialTermResults:i.Search.GetArrayFromResultList(n.data.d.query.PrimaryQueryResult.SpecialTermResults)},SpellingSuggestion:n.data.d.query.SpellingSuggestion}},GetArrayFromRefiners:function(n){var i,t,r;if(n===null)return null;for(i=[],t=0;t<n.Refiners.results.length;t++)r={Name:n.Refiners.results[t].Name,results:n.Refiners.results[t].Entries.results},i.push(r);return i},GetArrayFromResultList:function(n){var f,u,i,r,t;if(n===null)return null;for(f={Results:[],RowCount:n.RowCount},u=0;u<n.Table.Rows.results.length;u++){for(i=n.Table.Rows.results[u],r={},t=0;t<i.Cells.results.length;t++)switch(i.Cells.results[t].ValueType){case"Edm.Double":case"Edm.Int64":r[i.Cells.results[t].Key]=Number(i.Cells.results[t].Value);break;case"Edm.DateTime":r[i.Cells.results[t].Key]=new Date(i.Cells.results[t].Value);break;case"Edm.Boolean":r[i.Cells.results[t].Key]=i.Cells.results[t].Value==="true";break;default:r[i.Cells.results[t].Key]=i.Cells.results[t].Value}f.Results.push(r)}return f}};this.Profile={GetCurrentUser:function(r,u,f){var o,e,s,c,h;if(r=i.SanitizeWebUrl(r),o="/SP.UserProfiles.PeopleManager/GetMyProperties",typeof u!="undefined"){e="";for(s in u)if(u.hasOwnProperty(s)){if(s==="LoadPage"){o=u[s];break}e.length==0&&(e="?");e+=s+"="+u[s]+"&"}e.lastIndexOf("&")==e.length-1&&(e=e.substring(0,e.length-1));o+=e}return typeof f=="undefined"||f===null||f===""?(o=r+"_api"+o,c=n({url:o,method:"GET",headers:{Accept:"application/json; odata=verbose"}})):c=i.Support.SendRequestViaExecutor(o,r,f,null,"GET"),h=t.defer(),c.then(function(n){h.resolve(i.Support.GetJustTheData(n))},function(n){h.reject(n)}),h.promise},GetForUser:function(r,u,f,e){var s,o,h,l,c;if(r=i.SanitizeWebUrl(r),s="/SP.UserProfiles.PeopleManager/GetPropertiesFor(accountName=@v)?@v='"+u+"'",typeof f!="undefined"){o="";for(h in f)if(f.hasOwnProperty(h)){if(h==="LoadPage"){s=f[h];break}o.length==0&&(o="?");o+=h+"="+f[h]+"&"}o.lastIndexOf("&")==o.length-1&&(o=o.substring(0,o.length-1));s+=o}return typeof e=="undefined"||e===null||e===""?(s=r+"_api"+s,l=n({url:s,method:"GET",headers:{Accept:"application/json; odata=verbose"}})):l=i.Support.SendRequestViaExecutor(s,r,e,null,"GET"),c=t.defer(),l.then(function(n){c.resolve(i.Support.GetJustTheData(n))},function(n){c.reject(n)}),c.promise}}}]);angularSP.service("AngularSPCSOM",["$q",function(n){var t=this;this.GetItemTypeForListName=function(n){return"SP.Data."+n.charAt(0).toUpperCase()+n.split(" ").join("").slice(1)+"ListItem"};this.SanitizeWebUrl=function(n){return(typeof n=="undefined"||n==null||n=="")&&(n=_spPageContextInfo.siteAbsoluteUrl),n};this.CreateListItem=function(i,r,u){var h,f,o;r=t.SanitizeWebUrl(r);var e=new SP.ClientContext(r),c=e.get_web().get_lists().getByTitle(i),l=new SP.ListItemCreationInformation,s=c.addItem(l);for(h in u)s.set_item(h,u[h]);return s.update(),f={Context:e,List:c,ListItem:s},e.load(f.ListItem),o=n.defer(),e.executeQueryAsync(Function.createDelegate(f,function(){o.resolve(f.ListItem.get_fieldValues())}),Function.createDelegate(f,function(n,t){o.reject(t)})),o.promise};this.GetItemById=function(i,r,u){var f;u=t.SanitizeWebUrl(u);var e=new SP.ClientContext(u),s=e.get_web().get_lists().getByTitle(r),o=s.getItemById(i);return e.load(o),f=n.defer(),e.executeQueryAsync(function(){f.resolve(o.get_fieldValues())},function(n,t){f.reject(t)}),f.promise};this.GetArrayFromJSOMEnumerator=function(n){for(var t=n.getEnumerator(),i=[],r;t.moveNext();)r=t.get_current(),i.push(r.get_fieldValues());return i};this.GetListItems=function(i,r,u){var f,o;r=t.SanitizeWebUrl(r);var e=new SP.ClientContext(r),s=e.get_web().get_lists().getByTitle(i),h=new SP.CamlQuery;return typeof u!="undefined"&&h.set_viewXml(u),f={Context:e,List:s},f.collListItem=s.getItems(h),o=n.defer(),e.load(f.collListItem),e.executeQueryAsync(Function.createDelegate(f,function(){var n=t.GetArrayFromJSOMEnumerator(f.collListItem);o.resolve(n)}),Function.createDelegate(this,function(n,t){o.reject(t)})),o.promise};this.UpdateListItem=function(i,r,u,f){var c,e,o;u=t.SanitizeWebUrl(u);var s=new SP.ClientContext(u),l=s.get_web().get_lists().getByTitle(r),h=l.getItemById(i);for(c in f)h.set_item(c,f[c]);return h.update(),e={Context:s,List:l,ListItem:h},o=n.defer(),s.executeQueryAsync(Function.createDelegate(e,function(){o.resolve(e.ListItem.get_fieldValues())}),Function.createDelegate(e,function(n,t){o.reject(t)})),o.promise};this.DeleteListItem=function(i,r,u){var f;u=t.SanitizeWebUrl(u);var e=new SP.ClientContext(u),o=e.get_web().get_lists().getByTitle(r),s=o.getItemById(i);return s.deleteObject(),f=n.defer(),e.executeQueryAsync(function(){f.resolve()},function(n,t){f.reject(t)}),f.promise};this.GetGroup=function(n,i,r){r=t.SanitizeWebUrl(r);throw{name:"GetGroup",level:"Not Implemented",message:"Not Implemented",htmlMessage:"Not Implemented",toString:function(){return this.name+": "+this.message}};};this.GetSiteUsers=function(n){n=t.SanitizeWebUrl(n);throw{name:"GetSiteUsers",level:"Not Implemented",message:"Not Implemented",htmlMessage:"Not Implemented",toString:function(){return this.name+": "+this.message}};};this.GetUserById=function(n,i){i=t.SanitizeWebUrl(i);throw{name:"GetUserById",level:"Not Implemented",message:"Not Implemented",htmlMessage:"Not Implemented",toString:function(){return this.name+": "+this.message}};};this.AddUsertoGroup=function(n,i,r){r=t.SanitizeWebUrl(r);throw{name:"AddUsertoGroup",level:"Not Implemented",message:"Not Implemented",htmlMessage:"Not Implemented",toString:function(){return this.name+": "+this.message}};};this.GetUserId=function(i,r){r=t.SanitizeWebUrl(r);var u=n.defer(),f=new SP.ClientContext(r),e=f.get_web().ensureUser(i);return f.load(e),f.executeQueryAsync(function(){u.resolve(e)},function(n,t){u.reject(e,t)}),u.promise};this.CreateSubSite=function(i,r){r=t.SanitizeWebUrl(r);throw{name:"CreateSubSite",level:"Not Implemented",message:"Not Implemented",htmlMessage:"Not Implemented",toString:function(){return this.name+": "+this.message}};var f,e,u};this.GetWebData=function(n){n=t.SanitizeWebUrl(n);throw{name:"GetWebData",level:"Not Implemented",message:"Not Implemented",htmlMessage:"Not Implemented",toString:function(){return this.name+": "+this.message}};};this.UpdateWebData=function(i,r){i=t.SanitizeWebUrl(i);throw{name:"UpdateWebData",level:"Not Implemented",message:"Not Implemented",htmlMessage:"Not Implemented",toString:function(){return this.name+": "+this.message}};var f,u};this.Search=function(i,r){var f,u,h,o,e;if(i=t.SanitizeWebUrl(i),f=new SP.ClientContext(i),u=new Microsoft.SharePoint.Client.Search.Query.KeywordQuery(f),typeof r.querytext!="undefined"&&u.set_queryText(r.querytext),typeof r.rowlimit!="undefined"&&u.set_rowLimit(r.rowlimit),typeof r.trimduplicates!="undefined"&&u.set_trimDuplicates(r.trimduplicates),typeof r.sortlist!="undefined"&&u.set_sortList(r.sortlist),typeof r.querytemplate!="undefined"&&u.set_queryTemplate(r.querytemplate),typeof r.enableinterleaving!="undefined"&&u.set_enableInterleaving(r.enableinterleaving),typeof r.sourceid!="undefined"&&u.set_sourceId(r.sourceid),typeof r.rankingmodelid!="undefined"&&u.set_rankingModelId(r.rankingmodelid),typeof r.startrow!="undefined"&&u.set_startRow(r.startrow),typeof r.rowsperpage!="undefined"&&u.set_rowsPerPage(r.rowsperpage),typeof r.selectproperties!="undefined")for(h=u.get_selectProperties(),o=[].concat(r.selectproperties),e=0;e<o.length;e++)h.add(o[e]);typeof r.trimduplicates!="undefined"&&u.set_trimDuplicates(r.trimduplicates);typeof r.trimduplicates!="undefined"&&u.set_trimDuplicates(r.trimduplicates);typeof r.trimduplicates!="undefined"&&u.set_trimDuplicates(r.trimduplicates);typeof r.trimduplicates!="undefined"&&u.set_trimDuplicates(r.trimduplicates);typeof r.trimduplicates!="undefined"&&u.set_trimDuplicates(r.trimduplicates);typeof r.trimduplicates!="undefined"&&u.set_trimDuplicates(r.trimduplicates);typeof r.trimduplicates!="undefined"&&u.set_trimDuplicates(r.trimduplicates);typeof r.trimduplicates!="undefined"&&u.set_trimDuplicates(r.trimduplicates);typeof r.trimduplicates!="undefined"&&u.set_trimDuplicates(r.trimduplicates);typeof r.trimduplicates!="undefined"&&u.set_trimDuplicates(r.trimduplicates);typeof r.trimduplicates!="undefined"&&u.set_trimDuplicates(r.trimduplicates);typeof r.trimduplicates!="undefined"&&u.set_trimDuplicates(r.trimduplicates);typeof r.trimduplicates!="undefined"&&u.set_trimDuplicates(r.trimduplicates);typeof r.trimduplicates!="undefined"&&u.set_trimDuplicates(r.trimduplicates);typeof r.trimduplicates!="undefined"&&u.set_trimDuplicates(r.trimduplicates);typeof r.trimduplicates!="undefined"&&u.set_trimDuplicates(r.trimduplicates);typeof r.trimduplicates!="undefined"&&u.set_trimDuplicates(r.trimduplicates);typeof r.trimduplicates!="undefined"&&u.set_trimDuplicates(r.trimduplicates);typeof r.trimduplicates!="undefined"&&u.set_trimDuplicates(r.trimduplicates);var l=new Microsoft.SharePoint.Client.Search.Query.SearchExecutor(f),a=l.executeQuery(u),c={results:a},s=n.defer();return f.executeQueryAsync(Function.createDelegate(c,function(){var n={ElapsedTime:this.results.m_value.ElapsedTime,PrimaryQueryResult:{RefinementResults:[],RelevantResults:[],SpecialTermResults:[]},SpellingSuggestion:this.results.m_value.SpellingSuggestion},t=this.results;$.each(t.m_value.ResultTables,function(i,r){r.TableType=="RelevantResults"?n.PrimaryQueryResult.RelevantResults=t.m_value.ResultTables[i].ResultRows:r.TableType=="RefinementResults"?n.PrimaryQueryResult.RefinementResults=t.m_value.ResultTables[i].ResultRows:r.TableType=="SpecialTermResults"&&(n.PrimaryQueryResult.SpecialTermResults=t.m_value.ResultTables[i].ResultRows)});s.resolve(n)}),Function.createDelegate(c,function(n,t){s.reject(t)})),s.promise}}]);