var angularSP=angular.module("AngularSP",[]);angularSP.service("AngularSPREST",["$http","$q","$timeout",function(n,t,i){var r=this,u,f;console.log("AngularSPREST Initializing");this.SetDigestExpiration=function(){};u=null;f=null;this.GetUpdatedDigest=function(t){t=r.SanitizeWebUrl(t);var e=n({url:t+"/_api/contextinfo",method:"POST",headers:{Accept:"application/json; odata=verbose"}}).then(function(n){u=n.data.d.GetContextWebInformation.FormDigestValue;var e=n.data.d.GetContextWebInformation.FormDigestTimeoutSeconds;f=i(function(){r.GetUpdatedDigest(t)},(e-1)*1e3)},function(){console.log("Error getting new digest")})};this.GetItemTypeForListName=function(n){return"SP.Data."+n.charAt(0).toUpperCase()+n.split(" ").join("").slice(1)+"ListItem"};this.GetUrlPrefix=function(){r.IsSharePointHostedApp};this.SanitizeWebUrl=function(n){return(typeof n=="undefined"||n==null||n=="")&&(n=_spPageContextInfo.siteAbsoluteUrl),n};this.GetUpdatedDigest("/TestAngularSP");this.CreateListItem=function(i,u,f){var s=r.GetItemTypeForListName(i),e,o;return u=r.SanitizeWebUrl(u),e=t.defer(),o=n({url:u+"/_api/web/lists/getbytitle('"+i+"')/items",method:"POST",data:f,headers:{Accept:"application/json;odata=verbose","X-RequestDigest":$("#__REQUESTDIGEST").val()}}),o.then(function(n){e.resolve(n.data.d)},function(n){e.reject(n)}),e.promise};this.GetItemById=function(t,i,u,f){var e;return u=r.SanitizeWebUrl(u),e=u+"/_api/web/lists/getbytitle('"+i+"')/items("+t+")",typeof f!="undefined"&&f!=""&&(e+="?"+f),n({url:e,method:"GET",headers:{Accept:"application/json; odata=verbose"}})};this.GetListItems=function(i,u,f){var e,o,h,s;u=r.SanitizeWebUrl(u);typeof f=="string"&&(f={$filter:f});e=u+"/_api/web/lists/getbytitle('"+i+"')/items";f.length>0&&(e+="?");for(o in f)if(f.hasOwnProperty(o)){if(o==="LoadPage"){e=f[o];break}e+=o+"="+f[o]+"&"}return e.lastIndexOf("&")==e.length-1&&(e=e.substring(0,e.length-1)),h=n({url:e,method:"GET",headers:{Accept:"application/json; odata=verbose"}}),s=t.defer(),h.then(function(n){s.resolve(n.data.d.results)},function(n){s.reject(n)}),s.promise};this.GetListItemsByCAML=function(i,u,f,e){var o,s,c,h;u=r.SanitizeWebUrl(u);o=u+"/_api/web/lists/getbytitle('"+i+'\')/GetItems(query=@v1)?@v1={"ViewXml":"'+f+'"}';e.length>0&&(o+="&");for(s in e)e.hasOwnProperty(s)&&(o+=s+"="+e[s]+"&");return o.lastIndexOf("&")==o.length-1&&(o=o.substring(0,o.length-1)),c=n({url:o,method:"POST",headers:{Accept:"application/json;odata=verbose","X-RequestDigest":$("#__REQUESTDIGEST").val()}}),h=t.defer(),c.then(function(n){n.ExtraData=extraData;h.resolve(n)},function(n){n.ExtraData=extraData;h.reject(n)}),h.promise};this.UpdateListItem=function(i,u,f,e){f=r.SanitizeWebUrl(f);var s=r.GetItemTypeForListName(u),o=t.defer();return r.GetItemById(i,u,f).then(function(t){var i=n({url:t.data.d.__metadata.uri,method:"POST",contentType:"application/json;odata=verbose",data:JSON.stringify(e),headers:{Accept:"application/json;odata=verbose","X-RequestDigest":$("#__REQUESTDIGEST").val(),"X-HTTP-Method":"MERGE","If-Match":t.data.d.__metadata.etag}});i.then(function(n){o.resolve(n)},function(n){o.reject(n)})}),o.promise};this.DeleteListItem=function(i,u,f){f=r.SanitizeWebUrl(f);var e=t.defer();return r.GetItemById(i,u,f).then(function(t){var i=n({url:t.data.d.__metadata.uri,method:"DELETE",headers:{Accept:"application/json;odata=verbose","X-Http-Method":"DELETE","X-RequestDigest":$("#__REQUESTDIGEST").val(),"If-Match":t.data.d.__metadata.etag}});i.then(function(n){e.resolve(n)},function(n){e.reject(n)})}),e.promise};this.GetGroup=function(t,i,u){var f;return u=r.SanitizeWebUrl(u),f=u+"/_api/web/sitegroups?$filter=(Title%20eq%20%27"+t+"%27)",i&&(f=f+"&$expand=Users"),n({url:f,method:"GET",headers:{Accept:"application/json; odata=verbose"}})};this.GetSiteUsers=function(t){t=r.SanitizeWebUrl(t);var i=t+"/_api/web/SiteUsers";return n({url:i,method:"GET",headers:{Accept:"application/json; odata=verbose"}})};this.GetUserById=function(t,i){i=r.SanitizeWebUrl(i);var u=i+"/_api/Web/GetUserById("+t+")";return n({url:u,method:"GET",headers:{Accept:"application/json; odata=verbose"}})};this.AddUsertoGroup=function(t,i,u){var f;return u=r.SanitizeWebUrl(u),f={LoginName:i},f.__metadata={type:"SP.User"},u=r.SanitizeWebUrl(u),n({url:u+"/_api/web/sitegroups("+t+")/users",type:"POST",contentType:"application/json;odata=verbose",data:JSON.stringify(f),headers:{Accept:"application/json;odata=verbose","X-RequestDigest":$("#__REQUESTDIGEST").val()}})};this.GetUserId=function(n){var i=t.defer(),r=new SP.ClientContext.get_current,u=r.get_web().ensureUser(n);return r.load(u),r.executeQueryAsync(Function.createDelegate(null,function(){i.resolve(u)}),Function.createDelegate(null,function(){i.reject(u,args)})),i.promise};this.CreateSubSite=function(i,u){u=r.SanitizeWebUrl(u);var o={parameters:{__metadata:{type:"SP.WebInfoCreationInformation"},Url:i.siteUrl,Title:i.siteName,Description:i.siteDescription,Language:1033,WebTemplate:i.siteTemplate,UseUniquePermissions:i.uniquePermissions}},f=t.defer(),e,h=location.protocol+"//"+location.host,s=n({url:u+"/_api/contextinfo",method:"POST",headers:{Accept:"application/json; odata=verbose"},success:function(n){e=n.d.GetContextWebInformation.FormDigestValue},error:function(n,t,i){alert(i)}});return t.when(s).done(function(){n({url:u+"/_api/web/webinfos/add",type:"POST",headers:{accept:"application/json;odata=verbose","content-type":"application/json;odata=verbose","X-RequestDigest":e},data:JSON.stringify(o)}).then(function(n){f.resolve(n)})}),f.promise};this.GetWebData=function(t){t=r.SanitizeWebUrl(t);var i=t+"/_api/web";return n({url:i,method:"GET",headers:{Accept:"application/json; odata=verbose"}})};this.UpdateWebData=function(i,u){i=r.SanitizeWebUrl(i);var e,o=n({url:i+"/_api/contextinfo",method:"POST",headers:{Accept:"application/json; odata=verbose"},success:function(n){e=n.d.GetContextWebInformation.FormDigestValue},error:function(n,t,i){alert(i)}}),f=t.defer();return u.__metadata={type:"SP.Web"},t.when(o).done(function(){r.GetWebData(i).then(function(t){n({url:t.d.__metadata.uri,type:"POST",contentType:"application/json;odata=verbose",data:JSON.stringify(u),headers:{Accept:"application/json;odata=verbose","X-RequestDigest":$("#__REQUESTDIGEST").val(),"X-HTTP-Method":"MERGE","If-Match":t.d.__metadata.etag}}).then(function(n){f.resolve(n)},function(n){f.reject(n)})})}),f.promise};this.AddFileToLibrary=function(t,i,u,f){i=r.SanitizeWebUrl(i);var e=i+"/_api/web/lists/getByTitle(@TargetLibrary)/RootFolder/Files/add(url=@TargetFileName,overwrite='true')?@TargetLibrary='"+t+"'&@TargetFileName='"+u+"'";return n({url:e,method:"POST",data:f,headers:{Accept:"application/json; odata=verbose","X-RequestDigest":$("#__REQUESTDIGEST").val()}})}}]);angularSP.service("AngularSPCSOM",["$q",function(n){var t=this;this.GetItemTypeForListName=function(n){return"SP.Data."+n.charAt(0).toUpperCase()+n.split(" ").join("").slice(1)+"ListItem"};this.SanitizeWebUrl=function(n){return(typeof n=="undefined"||n==null||n=="")&&(n=_spPageContextInfo.siteAbsoluteUrl),n};this.CreateListItem=function(i,r,u){var h,f,o;r=t.SanitizeWebUrl(r);var e=new SP.ClientContext(r),c=e.get_web().get_lists().getByTitle(i),l=new SP.ListItemCreationInformation,s=c.addItem(l);for(h in u)s.set_item(h,u[h]);return s.update(),f={Context:e,List:c,ListItem:s},e.load(f.ListItem),o=n.defer(),e.executeQueryAsync(Function.createDelegate(f,function(){o.resolve(f.ListItem.get_fieldValues())}),Function.createDelegate(f,function(n,t){o.reject(t)})),o.promise};this.GetItemById=function(i,r,u){var f;u=t.SanitizeWebUrl(u);var e=new SP.ClientContext(u),s=e.get_web().get_lists().getByTitle(r),o=s.getItemById(i);return e.load(o),f=n.defer(),e.executeQueryAsync(function(){f.resolve(o)},function(n,t){f.reject(t)}),f.promise};this.GetArrayFromJSOMEnumerator=function(n){for(var t=n.getEnumerator(),i=[],r;t.moveNext();)r=t.get_current(),i.push(r.get_fieldValues());return i};this.GetListItems=function(i,r,u){var f,o;r=t.SanitizeWebUrl(r);var e=new SP.ClientContext(r),s=e.get_web().get_lists().getByTitle(i),u=new SP.CamlQuery;return typeof u=="undefined"&&u.set_viewXml(u),f={Context:e,List:s},f.collListItem=s.getItems(u),o=n.defer(),e.load(f.collListItem),e.executeQueryAsync(Function.createDelegate(f,function(){var n=t.GetArrayFromJSOMEnumerator(f.collListItem);o.resolve(n)}),Function.createDelegate(this,function(n,t){o.reject(t)})),o.promise};this.UpdateListItem=function(i,r,u,f){var c,e,o;u=t.SanitizeWebUrl(u);var s=new SP.ClientContext(u),l=s.get_web().get_lists().getByTitle(r),h=l.getItemById(i);for(c in f)h.set_item(c,f[c]);return h.update(),e={Context:s,List:l,ListItem:h},o=n.defer(),s.executeQueryAsync(Function.createDelegate(e,function(){o.resolve(e.ListItem.get_fieldValues())}),Function.createDelegate(e,function(n,t){o.reject(t)})),o.promise};this.DeleteListItem=function(i,r,u){var f;u=t.SanitizeWebUrl(u);var e=new SP.ClientContext(u),o=e.get_web().get_lists().getByTitle(r),s=o.getItemById(i);return s.deleteObject(),f=n.defer(),e.executeQueryAsync(function(){f.resolve()},function(n,t){f.reject(t)}),f.promise};this.GetGroup=function(n,i,r){r=t.SanitizeWebUrl(r);throw{name:"GetGroup",level:"Not Implemented",message:"Not Implemented",htmlMessage:"Not Implemented",toString:function(){return this.name+": "+this.message}};};this.GetSiteUsers=function(n){n=t.SanitizeWebUrl(n);throw{name:"GetSiteUsers",level:"Not Implemented",message:"Not Implemented",htmlMessage:"Not Implemented",toString:function(){return this.name+": "+this.message}};};this.GetUserById=function(n,i){i=t.SanitizeWebUrl(i);throw{name:"GetUserById",level:"Not Implemented",message:"Not Implemented",htmlMessage:"Not Implemented",toString:function(){return this.name+": "+this.message}};};this.AddUsertoGroup=function(n,i,r){r=t.SanitizeWebUrl(r);throw{name:"AddUsertoGroup",level:"Not Implemented",message:"Not Implemented",htmlMessage:"Not Implemented",toString:function(){return this.name+": "+this.message}};};this.GetUserId=function(i,r){r=t.SanitizeWebUrl(r);var u=n.defer(),f=new SP.ClientContext(r),e=f.get_web().ensureUser(i);return f.load(e),f.executeQueryAsync(function(){u.resolve(e)},function(n,t){u.reject(e,t)}),u.promise};this.CreateSubSite=function(i,r){r=t.SanitizeWebUrl(r);throw{name:"CreateSubSite",level:"Not Implemented",message:"Not Implemented",htmlMessage:"Not Implemented",toString:function(){return this.name+": "+this.message}};var f,e,u};this.GetWebData=function(n){n=t.SanitizeWebUrl(n);throw{name:"GetWebData",level:"Not Implemented",message:"Not Implemented",htmlMessage:"Not Implemented",toString:function(){return this.name+": "+this.message}};};this.UpdateWebData=function(i,r){i=t.SanitizeWebUrl(i);throw{name:"UpdateWebData",level:"Not Implemented",message:"Not Implemented",htmlMessage:"Not Implemented",toString:function(){return this.name+": "+this.message}};var f,u}}]);
//# sourceMappingURL=AngularSP.min.js.map
